{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<style>
    :root {
        --bg: #f0f2f5;
        --card: #f8fafc;
        --primary: #667eea;
        --primary-dark: #5a67d8;
        --text: #2d3748;
        --text-light: #718096;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
    }

    body { background: var(--bg); font-family: 'Inter', sans-serif; }

    /* Neumorphic Shadows */
    .neu-shadow {
        background: var(--bg);
        box-shadow: 
            12px 12px 24px #d1d9e6,
            -12px -12px 24px #ffffff;
        transition: all 0.4s ease;
    }

    .neu-shadow:hover {
        box-shadow: 
            16px 16px 32px #d1d9e6,
            -16px -16px 32px #ffffff;
        transform: translateY(-6px);
    }

    .neu-shadow:active {
        box-shadow: 
            inset 6px 6px 12px #d1d9e6,
            inset -6px -6px 12px #ffffff;
        transform: translateY(2px);
    }

    .neu-inset {
        box-shadow: 
            inset 8px 8px 16px #d1d9e6,
            inset -8px -8px 16px #ffffff;
    }

    /* Glass Card */
    .glass-card {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 1.5rem;
    }

    /* Breadcrumb */
    .breadcrumb-neu {
        background: var(--bg);
        border-radius: 50px;
        padding: 0.75rem 1.5rem;
        display: inline-flex;
        box-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
    }

    .breadcrumb-item a {
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .breadcrumb-item a:hover {
        color: var(--primary-dark);
        transform: translateX(2px);
    }

    /* Gallery */
    .gallery-main {
        height: 480px;
        object-fit: cover;
        border-radius: 1.5rem;
        transition: all 0.4s ease;
    }

    .gallery-main:hover {
        transform: scale(1.02);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
    }

    .thumbnail-neu {
        height: 90px;
        object-fit: cover;
        border-radius: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 3px solid transparent;
        box-shadow: 6px 6px 12px #d1d9e6, -6px -6px 12px #ffffff;
    }

    .thumbnail-neu:hover {
        transform: translateY(-4px);
        box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
    }

    .thumbnail-neu.active {
        border-color: var(--primary);
        box-shadow: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
    }

    /* Badges */
    .badge-neu {
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.8rem;
        backdrop-filter: blur(8px);
    }

    .badge-discount {
        background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        color: white;
        animation: pulse 2s infinite;
    }

    /* Price */
    .price-large {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .price-original {
        font-size: 1.5rem;
        color: var(--text-light);
        text-decoration: line-through;
    }

    .savings-badge {
        background: #ecfdf5;
        color: var(--success);
        border-radius: 50px;
        padding: 0.4rem 0.8rem;
        font-weight: 600;
    }

    /* Quantity */
    .quantity-group {
        background: var(--bg);
        border-radius: 50px;
        padding: 0.5rem;
        display: inline-flex;
        align-items: center;
        box-shadow: inset 6px 6px 12px #d1d9e6, inset -6px -6px 12px #ffffff;
    }

    .quantity-btn {
        width: 48px;
        height: 48px;
        background: var(--bg);
        color: var(--primary);
        border: none;
        border-radius: 50%;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 6px 6px 12px #d1d9e6, -6px -6px 12px #ffffff;
        transition: all 0.3s ease;
    }

    .quantity-btn:hover {
        background: var(--primary);
        color: white;
        transform: scale(1.1);
    }

    .quantity-input {
        width: 70px;
        height: 48px;
        background: transparent;
        border: none;
        text-align: center;
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--text);
    }

    /* Action Buttons */
    .btn-neu-primary {
        background: var(--bg);
        color: var(--primary);
        border: none;
        border-radius: 50px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
        transition: all 0.3s ease;
    }

    .btn-neu-primary:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-4px);
        box-shadow: 10px 10px 20px #d1d9e6, -10px -10px 20px #ffffff;
    }

    .btn-neu-outline {
        background: transparent;
        color: var(--primary);
        border: 2px solid var(--primary);
        border-radius: 50px;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-neu-outline:hover {
        background: var(--primary);
        color: white;
    }

    /* Feature Cards */
    .feature-card-neu {
        background: var(--bg);
        border-radius: 1.5rem;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
        transition: all 0.3s ease;
    }

    .feature-card-neu:hover {
        transform: translateY(-6px);
        box-shadow: 12px 12px 24px #d1d9e6, -12px -12px 24px #ffffff;
    }

    .feature-icon {
        width: 60px;
        height: 60px;
        background: var(--bg);
        color: var(--primary);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.5rem;
        box-shadow: 6px 6px 12px #d1d9e6, -6px -6px 12px #ffffff;
        animation: float 3s ease-in-out infinite;
    }

    /* Tabs */
    .nav-tabs-neu {
        border: none;
        background: var(--bg);
        border-radius: 50px;
        padding: 0.5rem;
        display: inline-flex;
        box-shadow: inset 6px 6px 12px #d1d9e6, inset -6px -6px 12px #ffffff;
    }

    .nav-tabs-neu .nav-link {
        border: none;
        color: var(--text-light);
        font-weight: 600;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        transition: all 0.3s ease;
    }

    .nav-tabs-neu .nav-link.active {
        background: var(--primary);
        color: white;
        box-shadow: 6px 6px 12px #d1d9e6, -6px -6px 12px #ffffff;
    }

    .tab-content-neu {
        background: var(--bg);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-top: 1rem;
        box-shadow: inset 8px 8px 16px #d1d9e6, inset -8px -8px 16px #ffffff;
    }

    /* Rating */
    .rating-large {
        font-size: 3rem;
        font-weight: 800;
        color: var(--primary);
    }

    /* Animations */
    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    .animate-fade-up {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeUp 0.6s ease forwards;
    }

    @keyframes fadeUp {
        to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive */
    @media (max-width: 768px) {
        .gallery-main { height: 300px; }
        .price-large { font-size: 2rem; }
        .quantity-group { flex-direction: column; gap: 0.5rem; }
        .quantity-btn { width: 44px; height: 44px; }
    }
</style>
{% endblock %}

{% block content %}
<main class="py-5">
    <div class="container">

        <!-- Breadcrumb -->
        <nav class="mb-5">
            <ol class="breadcrumb breadcrumb-neu m-0 p-0 list-unstyled d-flex align-items-center gap-3">
                <li class="breadcrumb-item">
                    <a href="{% url 'core:home' %}">Home</a>
                </li>
                <li class="text-muted">›</li>
                <li class="breadcrumb-item">
                    <a href="{% url 'core:home' %}?category={{ object.category }}">{{ object.get_category_display }}</a>
                </li>
                <li class="text-muted">›</li>
                <li class="breadcrumb-item text-primary fw-bold">{{ object.title|truncatewords:5 }}</li>
            </ol>
        </nav>

        <div class="row g-5">
            <!-- Gallery -->
            <div class="col-lg-6">
                <div class="glass-card p-4 neu-shadow">
                    <!-- Main Image -->
                    <div class="mb-4 overflow-hidden rounded-3">
                        {% if object.image %}
                        <img src="{{ object.image.url }}" class="img-fluid gallery-main w-100" alt="{{ object.title }}" id="mainImage">
                        {% else %}
                        <div class="bg-light gallery-main d-flex align-items-center justify-content-center">
                            <i class="fas fa-image fa-4x text-muted"></i>
                        </div>
                        {% endif %}

                        {% if object.discount_price %}
                        <span class="badge-neu badge-discount position-absolute top-0 end-0 m-3">
                            {{ object.get_discount_percentage }}% OFF
                        </span>
                        {% endif %}
                    </div>

                    <!-- Thumbnails -->
                    <div class="row g-3">
                        {% if object.image %}
                        <div class="col-3">
                            <img src="{{ object.image.url }}" class="img-fluid thumbnail-neu active" 
                                 data-full="{{ object.image.url }}" onclick="changeMainImage(this)" alt="thumb 1">
                        </div>
                        {% endif %}
                        {% if object.image_2 %}
                        <div class="col-3">
                            <img src="{{ object.image_2.url }}" class="img-fluid thumbnail-neu" 
                                 data-full="{{ object.image_2.url }}" onclick="changeMainImage(this)" alt="thumb 2">
                        </div>
                        {% endif %}
                        {% if object.image_3 %}
                        <div class="col-3">
                            <img src="{{ object.image_3.url }}" class="img-fluid thumbnail-neu" 
                                 data-full="{{ object.image_3.url }}" onclick="changeMainImage(this)" alt="thumb 3">
                        </div>
                        {% endif %}
                        {% if object.image_4 %}
                        <div class="col-3">
                            <img src="{{ object.image_4.url }}" class="img-fluid thumbnail-neu" 
                                 data-full="{{ object.image_4.url }}" onclick="changeMainImage(this)" alt="thumb 4">
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Product Info -->
            <div class="col-lg-6">
                <div class="glass-card p-5 neu-shadow h-100 d-flex flex-column">
                    <!-- Badges -->
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <div class="d-flex gap-2">
                            <span class="badge-neu bg-primary text-white">{{ object.get_category_display }}</span>
                            {% if object.label == 'N' %}
                            <span class="badge-neu bg-success text-white">New</span>
                            {% elif object.label == 'B' %}
                            <span class="badge-neu bg-warning text-white">Bestseller</span>
                            {% endif %}
                        </div>
                        <span class="badge-neu bg-success text-white">In Stock</span>
                    </div>

                    <!-- Title -->
                    <h1 class="h3 fw-bold mb-3 animate-fade-up" style="animation-delay: 0.1s;">{{ object.title }}</h1>

                    <!-- Rating -->
                    <div class="d-flex align-items-center mb-4 animate-fade-up" style="animation-delay: 0.2s;">
                        <div class="text-warning me-2">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        </div>
                        <span class="text-muted">4.5 • 128 reviews</span>
                    </div>

                    <!-- Price -->
                    <div class="mb-4 p-4 rounded-3 neu-inset animate-fade-up" style="animation-delay: 0.3s;">
                        {% if object.discount_price %}
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <span class="price-large">${{ object.discount_price }}</span>
                                <span class="price-original ms-3">${{ object.price }}</span>
                            </div>
                            <div class="text-end">
                                <div class="savings-badge">Save ${{ object.get_savings_amount }}</div>
                            </div>
                        </div>
                        {% else %}
                        <div class="price-large">${{ object.price }}</div>
                        {% endif %}
                    </div>

                    <!-- Description -->
                    <p class="text-muted mb-4 flex-grow-1 animate-fade-up" style="animation-delay: 0.4s;">
                        {{ object.description }}
                    </p>

                    <!-- Quantity -->
                    <div class="mb-4 animate-fade-up" style="animation-delay: 0.5s;">
                        <label class="form-label fw-bold mb-3">Quantity</label>
                        <div class="quantity-group">
                            <button class="quantity-btn" onclick="decreaseQuantity()">-</button>
                            <input type="number" id="quantity" value="1" min="1" max="10" class="quantity-input" readonly>
                            <button class="quantity-btn" onclick="increaseQuantity()">+</button>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="d-flex gap-3 mb-4 animate-fade-up" style="animation-delay: 0.6s;">
                        <a href="{{ object.get_add_to_cart_url }}" class="btn btn-neu-primary flex-fill" id="addToCartBtn">
                            Add to Cart
                        </a>
                        <button class="btn btn-neu-outline flex-fill" onclick="addToWishlist()">
                            Wishlist
                        </button>
                    </div>

                    <!-- Features -->
                    <div class="row g-3 text-center animate-fade-up" style="animation-delay: 0.7s;">
                        <div class="col-4">
                            <div class="feature-card-neu">
                                <div class="feature-icon"><i class="fas fa-shipping-fast"></i></div>
                                <div class="fw-bold">Free Shipping</div>
                                <small class="text-muted">Over $50</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="feature-card-neu">
                                <div class="feature-icon"><i class="fas fa-undo"></i></div>
                                <div class="fw-bold">Easy Returns</div>
                                <small class="text-muted">30 Days</small>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="feature-card-neu">
                                <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                                <div class="fw-bold">2-Year Warranty</div>
                                <small class="text-muted">Guaranteed</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="glass-card p-4 mt-5 neu-shadow">
            <ul class="nav nav-tabs-neu mb-4" id="productTabs">
                <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#desc">Description</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#specs">Specs</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#reviews">Reviews</button>
                </li>
            </ul>

            <div class="tab-content tab-content-neu">
                <div class="tab-pane fade show active" id="desc">
                    <h4>About This Product</h4>
                    <p class="lead">{{ object.description }}</p>
                    <ul class="list-unstyled mt-3">
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Premium quality materials</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Easy to clean and maintain</li>
                        <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Durable and long-lasting</li>
                    </ul>
                </div>
                <div class="tab-pane fade" id="specs">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr><td class="fw-bold text-primary">Name</td><td>{{ object.title }}</td></tr>
                                <tr><td class="fw-bold text-primary">Category</td><td>{{ object.get_category_display }}</td></tr>
                                <tr><td class="fw-bold text-primary">Price</td><td>${{ object.price }}</td></tr>
                            </table>
                        </div>
                        {% if object.discount_price %}
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr><td class="fw-bold text-success">Discount</td><td class="text-success">${{ object.discount_price }}</td></tr>
                                <tr><td class="fw-bold text-success">You Save</td><td class="text-success">${{ object.get_savings_amount }}</td></tr>
                            </table>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="tab-pane fade" id="reviews">
                    <div class="text-center py-5">
                        <div class="rating-large mb-3">4.5</div>
                        <div class="text-warning mb-3">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        </div>
                        <p class="text-muted">Based on 128 reviews</p>
                        <button class="btn btn-neu-primary mt-3">Write a Review</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}

{% block extra_scripts %}
<script>
    function changeMainImage(el) {
        const main = document.getElementById('mainImage');
        main.src = el.dataset.full;
        document.querySelectorAll('.thumbnail-neu').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        main.style.opacity = '0.8';
        setTimeout(() => main.style.opacity = '1', 200);
    }

    function increaseQuantity() {
        const input = document.getElementById('quantity');
        if (parseInt(input.value) < 10) input.value = parseInt(input.value) + 1;
    }

    function decreaseQuantity() {
        const input = document.getElementById('quantity');
        if (parseInt(input.value) > 1) input.value = parseInt(input.value) - 1;
    }

    function addToWishlist() {
        const btn = event.target.closest('button');
        btn.innerHTML = 'Added!';
        btn.classList.add('btn-success');
        setTimeout(() => {
            btn.innerHTML = 'Wishlist';
            btn.classList.remove('btn-success');
        }, 2000);
    }

    document.getElementById('addToCartBtn').addEventListener('click', function(e) {
        const btn = this;
        const original = btn.innerHTML;
        btn.innerHTML = 'Adding...';
        btn.disabled = true;
        setTimeout(() => {
            btn.innerHTML = 'Added!';
            btn.classList.add('btn-success');
            setTimeout(() => {
                btn.innerHTML = original;
                btn.classList.remove('btn-success');
                btn.disabled = false;
            }, 1500);
        }, 800);
    });

    // Animate on load
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.animate-fade-up').forEach((el, i) => {
            el.style.animationDelay = `${i * 0.1}s`;
        });
    });
</script>
{% endblock %}